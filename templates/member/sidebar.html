{% block sidebar %}
<nav class="space-y-1">
    <a href="/member/dashboard" class="group flex items-center px-3 py-3 text-sm font-medium rounded-xl text-gray-700 hover:text-primary-600 hover:bg-primary-50 transition-all duration-200 hover:scale-105 hover:shadow-md">
        <div class="flex items-center justify-center w-10 h-10 rounded-lg bg-primary-100 text-primary-600 group-hover:bg-primary-200 transition-all duration-200 mr-3">
            <i class="fas fa-home text-lg"></i>
        </div>
        <span class="font-medium">Dashboard</span>
        <div class="ml-auto opacity-0 group-hover:opacity-100 transition-opacity duration-200">
            <i class="fas fa-arrow-right text-xs"></i>
        </div>
    </a>
    
    <a href="/member/schedule" class="group flex items-center px-3 py-3 text-sm font-medium rounded-xl text-gray-700 hover:text-primary-600 hover:bg-primary-50 transition-all duration-200 hover:scale-105 hover:shadow-md">
        <div class="flex items-center justify-center w-10 h-10 rounded-lg bg-blue-100 text-blue-600 group-hover:bg-blue-200 transition-all duration-200 mr-3">
            <i class="fas fa-calendar-alt text-lg"></i>
        </div>
        <span class="font-medium">Schedule</span>
        <div class="ml-auto opacity-0 group-hover:opacity-100 transition-opacity duration-200">
            <i class="fas fa-arrow-right text-xs"></i>
        </div>
    </a>
    
    <a href="/member/progress" class="group flex items-center px-3 py-3 text-sm font-medium rounded-xl text-gray-700 hover:text-primary-600 hover:bg-primary-50 transition-all duration-200 hover:scale-105 hover:shadow-md">
        <div class="flex items-center justify-center w-10 h-10 rounded-lg bg-green-100 text-green-600 group-hover:bg-green-200 transition-all duration-200 mr-3">
            <i class="fas fa-chart-line text-lg"></i>
        </div>
        <span class="font-medium">Progress</span>
        <div class="ml-auto opacity-0 group-hover:opacity-100 transition-opacity duration-200">
            <i class="fas fa-arrow-right text-xs"></i>
        </div>
    </a>
    
    <a href="/member/preferences" class="group flex items-center px-3 py-3 text-sm font-medium rounded-xl text-gray-700 hover:text-primary-600 hover:bg-primary-50 transition-all duration-200 hover:scale-105 hover:shadow-md">
        <div class="flex items-center justify-center w-10 h-10 rounded-lg bg-purple-100 text-purple-600 group-hover:bg-purple-200 transition-all duration-200 mr-3">
            <i class="fas fa-cog text-lg"></i>
        </div>
        <span class="font-medium">Preferences</span>
        <div class="ml-auto opacity-0 group-hover:opacity-100 transition-opacity duration-200">
            <i class="fas fa-arrow-right text-xs"></i>
        </div>
    </a>
    
    <!-- AI Calorie Tracker - VIP Feature -->
    <div class="nutrition-tracker-item">
        <a href="#" class="group flex items-center px-3 py-3 text-sm font-medium rounded-xl transition-all duration-200 hover:scale-105 hover:shadow-md nutrition-tracker-link">
            <div class="flex items-center justify-center w-10 h-10 rounded-lg bg-gradient-to-br from-emerald-100 to-teal-100 text-emerald-600 group-hover:from-emerald-200 group-hover:to-teal-200 transition-all duration-200 mr-3">
                <i class="fas fa-utensils text-lg"></i>
            </div>
            <div class="flex-1">
                <span class="font-medium text-gray-700 group-hover:text-primary-600">AI Calorie Tracker</span>
                <div class="vip-badge hidden">
                    <span class="inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium bg-gradient-to-r from-yellow-400 to-orange-400 text-white shadow-sm">
                        <i class="fas fa-crown mr-1"></i>VIP
                    </span>
                </div>
                <div class="upgrade-badge">
                    <span class="inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium bg-gradient-to-r from-gray-400 to-gray-500 text-white shadow-sm">
                        <i class="fas fa-lock mr-1"></i>Premium Feature
                    </span>
                </div>
            </div>
            <div class="ml-auto opacity-0 group-hover:opacity-100 transition-opacity duration-200">
                <i class="fas fa-arrow-right text-xs"></i>
            </div>
        </a>
    </div>
    
    <!-- Divider -->
    <div class="relative py-2">
        <div class="absolute inset-0 flex items-center">
            <div class="w-full border-t border-gray-200"></div>
        </div>
        <div class="relative flex justify-center text-xs uppercase">
            <span class="bg-white px-2 text-gray-500 font-medium">Communication</span>
        </div>
    </div>
    
    <a href="/member/messages" class="group flex items-center px-3 py-3 text-sm font-medium rounded-xl text-gray-700 hover:text-primary-600 hover:bg-primary-50 transition-all duration-200 hover:scale-105 hover:shadow-md">
        <div class="flex items-center justify-center w-10 h-10 rounded-lg bg-orange-100 text-orange-600 group-hover:bg-orange-200 transition-all duration-200 mr-3">
            <i class="fas fa-envelope text-lg"></i>
        </div>
        <span class="font-medium">Messages</span>
        <div class="ml-auto opacity-0 group-hover:opacity-100 transition-opacity duration-200">
            <i class="fas fa-arrow-right text-xs"></i>
        </div>
    </a>
</nav>

<!-- User Stats Section -->
<div class="mt-6 p-4 bg-gradient-to-br from-primary-50 to-accent-50 rounded-xl border border-primary-100 shadow-sm">
    <h4 class="text-sm font-semibold text-gray-700 mb-3 flex items-center">
        <i class="fas fa-chart-pie text-primary-600 mr-2"></i>
        My Stats
    </h4>
    <div class="space-y-3">
        <div class="flex justify-between items-center">
            <span class="text-xs text-gray-600">This Week</span>
            <span class="text-xs font-semibold text-primary-600" id="weekSessions">0 sessions</span>
        </div>
        <div class="flex justify-between items-center">
            <span class="text-xs text-gray-600">Streak</span>
            <span class="text-xs font-semibold text-green-600" id="streakDays">0 days</span>
        </div>
        <div class="flex justify-between items-center">
            <span class="text-xs text-gray-600">Progress</span>
            <span class="text-xs font-semibold text-accent-600" id="progressPercent">65%</span>
        </div>
        
        <!-- Progress Bar -->
        <div class="w-full bg-gray-200 rounded-full h-2 mt-2">
            <div class="bg-gradient-to-r from-primary-500 to-accent-500 h-2 rounded-full transition-all duration-500" style="width: 65%" id="progressBar"></div>
        </div>
        <div class="text-center mt-1">
            <span class="text-xs text-gray-500">Weekly Goal Progress</span>
        </div>
    </div>
</div>

<script>
// Check user membership type and handle AI Calorie Tracker access
document.addEventListener('DOMContentLoaded', function() {
    // Get user info from template context
    const userMembershipType = '{{ user.membership_type if user else "Basic" }}';
    const nutritionTrackerLink = document.querySelector('.nutrition-tracker-link');
    const vipBadge = document.querySelector('.vip-badge');
    const upgradeBadge = document.querySelector('.upgrade-badge');
    
    if (userMembershipType === 'VIP' || userMembershipType === 'Premium') {
        // VIP/Premium user - show access badge and enable access
        vipBadge.classList.remove('hidden');
        upgradeBadge.style.display = 'none';
        nutritionTrackerLink.href = '/member/nutrition';
        nutritionTrackerLink.classList.add('text-gray-700', 'hover:text-primary-600', 'hover:bg-primary-50');
        
        // Update badge text based on membership type
        const badgeSpan = vipBadge.querySelector('span');
        if (userMembershipType === 'Premium') {
            badgeSpan.innerHTML = '<i class="fas fa-star mr-1"></i>Premium';
            badgeSpan.className = 'inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium bg-gradient-to-r from-blue-400 to-purple-400 text-white shadow-sm';
        }
    } else {
        // Non-VIP user - show upgrade prompt
        upgradeBadge.style.display = 'block';
        vipBadge.classList.add('hidden');
        
        // Add click handler for upgrade prompt
        nutritionTrackerLink.addEventListener('click', function(e) {
            e.preventDefault();
            showUpgradeModal();
        });
        
        // Style for locked feature
        nutritionTrackerLink.classList.add('text-gray-500', 'hover:text-gray-600', 'hover:bg-gray-50');
    }
});

function showUpgradeModal() {
    // Create upgrade modal
    const modal = document.createElement('div');
    modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
    modal.innerHTML = `
        <div class="bg-white rounded-xl p-6 max-w-md mx-4 shadow-xl">
            <div class="text-center">
                <div class="mx-auto flex items-center justify-center h-12 w-12 rounded-full bg-gradient-to-br from-yellow-400 to-orange-400 mb-4">
                    <i class="fas fa-crown text-white text-xl"></i>
                </div>
                <h3 class="text-lg font-semibold text-gray-900 mb-2">Upgrade to Premium or VIP</h3>
                <p class="text-gray-600 mb-4">Unlock the AI Calorie Tracker and get personalized nutrition coaching with photo analysis!</p>
                
                <div class="bg-gradient-to-br from-emerald-50 to-teal-50 rounded-lg p-4 mb-4">
                    <h4 class="font-semibold text-emerald-800 mb-2">Premium+ Features Include:</h4>
                    <ul class="text-sm text-emerald-700 space-y-1 text-left">
                        <li><i class="fas fa-camera text-emerald-600 mr-2"></i>AI Photo Food Analysis</li>
                        <li><i class="fas fa-robot text-emerald-600 mr-2"></i>Personalized Nutrition Coaching</li>
                        <li><i class="fas fa-chart-line text-emerald-600 mr-2"></i>Advanced Progress Tracking</li>
                        <li><i class="fas fa-comments text-emerald-600 mr-2"></i>Coach Nutrition Feedback</li>
                    </ul>
                </div>
                
                <div class="flex space-x-3">
                    <button onclick="this.closest('.fixed').remove()" class="flex-1 px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 rounded-lg hover:bg-gray-200 transition-colors">
                        Maybe Later
                    </button>
                    <button onclick="window.location.href='/member/upgrade'" class="flex-1 px-4 py-2 text-sm font-medium text-white bg-gradient-to-r from-yellow-400 to-orange-400 rounded-lg hover:from-yellow-500 hover:to-orange-500 transition-all">
                        Upgrade Now
                    </button>
                </div>
            </div>
        </div>
    `;
    
    document.body.appendChild(modal);
    
    // Close modal when clicking outside
    modal.addEventListener('click', function(e) {
        if (e.target === modal) {
            modal.remove();
        }
    });
}
</script>
{% endblock %} 